<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scan Result</title>

  <!-- ✅ Include Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
</head>
<body class="bg-light">

  <div class="container mt-5">
    <h3 class="mb-4 text-center">🚗 Vehicle OCR Result</h3>

    <div class="card shadow p-4">
      <!-- Raw OCR text -->
      <p><strong>Raw OCR Text:</strong></p>
      <p id="rawText" class="border rounded p-2 bg-white">{{ raw }}</p>

      <!-- Detected / Corrected Plate -->
      <label for="plateInput" class="mt-3"><strong>Detected / Corrected Plate:</strong></label>
      <div class="input-group">
        <input id="plateInput" class="form-control" value="{{ plate }}" />
        <button id="saveBtn" class="btn btn-primary">💾 Save corrected</button>
      </div>

      <!-- Action buttons -->
      <div class="mt-4 d-flex align-items-center gap-3">
        <button id="pdfBtn" class="btn btn-outline-secondary">📄 Generate PDF</button>
        <a href="/qr/{{ scan_id }}" target="_blank" class="btn btn-outline-info">🔗 QR</a>
        <span id="saveStatus" class="text-success fw-semibold"></span>
      </div>

      <!-- Optional: Preview QR on page (appears after click) -->
      <div id="qrPreview" class="mt-4 text-center" style="display:none;">
        <h6>QR Code:</h6>
        <img id="qrImg" src="" alt="QR Code" class="img-thumbnail" style="max-width:200px;">
      </div>
    </div>
  </div>

  <!-- ✅ Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // --- Save corrected plate ---
    document.getElementById('saveBtn').addEventListener('click', async () => {
      const corrected = document.getElementById('plateInput').value.trim().toUpperCase();

      const resp = await fetch('/save_correction', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          scan_id: "{{ scan_id }}",
          corrected_plate: corrected
        })
      });

      const j = await resp.json();
      if (j.success) {
        document.getElementById('saveStatus').textContent = '✅ Saved successfully!';
      } else {
        document.getElementById('saveStatus').textContent = '❌ Save failed';
      }
    });

    // --- Generate PDF ---
    document.getElementById('pdfBtn').addEventListener('click', () => {
      window.open('/report/{{ scan_id }}', '_blank');
    });

    // --- Optional: show QR code inline when clicking QR button ---
    const qrBtn = document.querySelector('a.btn-outline-info');
    qrBtn.addEventListener('click', (e) => {
      e.preventDefault();
      const qrImg = document.getElementById('qrImg');
      qrImg.src = "/qr/{{ scan_id }}";

      document.getElementById('qrPreview').style.display = 'block';
    });
  </script>

</body>
</html>